groups:
- name: zfs_node_exporter_alerts
  rules:

  - alert: ZFS_ARC_Size_Low
    expr: node_zfs_arc_size < (node_zfs_arc_c_min * 1.1)
    for: 10m
    labels:
      severity: warning
    annotations:
      summary: "ZFS ARC size is near or below minimum"
      description: "ARC size is approaching the configured minimum size. Check memory pressure or ARC tuning."

  - alert: ZFS_ARC_Hit_Ratio_Low
    expr: (node_zfs_arc_hits / (node_zfs_arc_hits + node_zfs_arc_misses)) < 0.80
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "ZFS ARC hit ratio is low"
      description: "ARC hit ratio is {{ $value | printf \"%.2f\" }}, which means data is frequently missed in ARC (cache)."

  - alert: ZFSPool_IO_Errors
    expr: node_zfs_pool_read_errors > 0 or node_zfs_pool_write_errors > 0 or node_zfs_pool_checksum_errors > 0
    for: 1m
    labels:
      severity: critical
    annotations:
      summary: "ZFS pool I/O error"
      description: "Pool '{{ $labels.pool }}' has read/write/checksum errors. Check 'zpool status'."

  - alert: ZFSPool_Health_Degraded
    expr: node_zfs_pool_health_status != 0
    for: 2m
    labels:
      severity: critical
    annotations:
      summary: "ZFS pool is not in ONLINE state"
      description: "Pool '{{ $labels.pool }}' has status {{ $value }} (expected 0 = ONLINE)."

  - alert: ZFSPool_Free_Space_Low
    expr: (node_zfs_pool_size_bytes - node_zfs_pool_allocated_bytes) / node_zfs_pool_size_bytes < 0.10
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "ZFS pool has low free space"
      description: "Pool '{{ $labels.pool }}' has less than 10% free space remaining."

  - alert: ZFS_L2ARC_IO_Errors
    expr: node_zfs_arc_l2_io_error > 0
    for: 2m
    labels:
      severity: warning
    annotations:
      summary: "ZFS L2ARC I/O errors"
      description: "There have been {{ $value }} I/O errors on L2ARC cache device."

  - alert: ZFS_L2ARC_Low_Hit_Ratio
    expr: (node_zfs_arc_l2_hits / (node_zfs_arc_l2_hits + node_zfs_arc_l2_misses)) < 0.10
    for: 5m
    labels:
      severity: info
    annotations:
      summary: "ZFS L2ARC cache is mostly ineffective"
      description: "L2ARC hit ratio is below 10%. Consider tuning ARC or reducing cache device load."

  - alert: ZFS_Deleted_Blocks_High
    expr: rate(node_zfs_dataset_deleted[5m]) > 1000
    for: 1m
    labels:
      severity: info
    annotations:
      summary: "ZFS is deleting large number of blocks"
      description: "Dataset '{{ $labels.dataset }}' is experiencing high deletion rate. Possibly high churn or snapshot operations."
